# Set default shell
set -g default-command $SHELL
set -g default-shell $SHELL

# Enable 24bit truecolor
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color*:RGB"
set -ag terminal-features ",*256color*:RGB@:mouse@:ccolour@:cstyle@:Ax@:Bidi@:Cs@:Cr@:Cmg@:Clmg@:Dsmg@:Enmg@:Dsbp@:Enbp@:Dseks@:Eneks@:Dsfcs@:Enfcs@:Rect@:Smol@:Smulx@:Setulc@:ol@:Ss@:Se@:Sync@:Ms@:XT@:clipboard@:extkeys@:focus@:margins@:overline@:rectfill@:strikethrough@:sync@:title@:usstyle@"

# Change PREFIX key binding
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# no delay
set -s escape-time 0

# history
set -g history-limit 10000

# Set Key Movment Keys For Buffer Mode
setw -g mode-keys vi
setw -g status-keys vi

# vim style commands
bind : command-prompt

# command messages displayed 4 seconds
set -g display-time 4000

# show times longer than supposed
set -g display-panes-time 2000

# word separators for automatic word selection
setw -g word-separators ' @"=()[]_-:,.'
setw -ag word-separators "'"

# Set title
set -g set-titles on
set -g set-titles-string "#T"

# split horiziontal and vertical splits, instead of % and "
# also open them in the same directory
unbind '"'
unbind %
bind v split-window -h -c '#{pane_current_path}'
bind s split-window -v -c '#{pane_current_path}'
bind c new-window -c "#{pane_current_path}"

# Pressing Ctrl+Shift+Left (will move the current window to the left. Similarly
# right. No need to use the modifier (C-b).
# bind-key -n C-S-Left swap-window -t -1
# bind-key -n C-S-Right swap-window -t +1

# shared clipboard
set -s set-clipboard on

# accept extended keys
set -s extended-keys on

# vim tmux seamless navigation <C-h/j/k/l>
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
bind -n C-h if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind -n C-j if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind -n C-k if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind -n C-l if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# resize panes
bind -r h resize-pane -L 3
bind -r j resize-pane -D 3
bind -r k resize-pane -U 3
bind -r l resize-pane -R 3

# equally resize all panes
bind = select-layout even-horizontal
bind | select-layout even-vertical


# copy to system clipboard
# bind -T copy-mode-vi 'v' send -X begin-selection
# bind -T copy-mode-vi 'y' send -X copy-pipe-and-cancel pbcopy
# bind -T cdit-mode-vi Up send -X history-up
# bind -T cdit-mode-vi Down send -X history-down
# unbind -T copy-mode-vi C-v ; bind -T copy-mode-vi C-v send -X rectangle-toggle
# unbind -T copy-mode-vi [ ; bind -T copy-mode-vi [ send -X begin-selection
# unbind -T copy-mode-vi ] ; bind -T copy-mode-vi ] send -X copy-selection

# running commands shouldn't rename windows
setw -g automatic-rename off

# base index start from 1
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# enable mouse
set -g mouse on

# clock
setw -g clock-mode-colour green

# client aggressive window resize
setw -g aggressive-resize on

# activity monitoring in other windows
set -g visual-activity on
setw -g monitor-activity on

# set refresh interval
set -g status-interval 1

set -g status-justify "centre"
set -g status "on"
set -g status-left-style "none"
set -g message-command-style "fg=#c6c8d1,bg=#2e3244"
set -g status-right-style "none"
set -g pane-active-border-style "fg=#454b68"
set -g status-style "none,bg=#1e2132"
set -g message-style "fg=#c6c8d1,bg=#2e3244"
set -g pane-border-style "fg=#2e3244"
set -g status-right-length "100"
set -g status-left-length "100"
setw -g window-status-activity-style "none,fg=#454b68,bg=#1e2132"
setw -g window-status-separator ""
setw -g window-status-style "none,fg=#c6c8d1,bg=#1e2132"

# modules
module_left_1="#H"
module_left_2="#(whoami)"
module_left_3="#S"
module_right_1="#(ip route get 1 | awk '{print $7}')"
module_right_2="%R %a"

# separators
# separator_left="  "
# separator_right="  "
# subseparator_left="\ue0bb"
# subseparator_right="\ue0bd"
separator_left=" "
separator_right=" "
subseparator_left=" "
subseparator_right=" "

set -g status-left "#[fg=#c6c8d1,bg=#454b68,bold] $module_left_1 #[fg=#454b68,bg=#2e3244,nobold,nounderscore,noitalics]$separator_left#[fg=#c6c8d1,bg=#2e3244] $module_left_2 #[fg=#2e3244,bg=#1e2132,nobold,nounderscore,noitalics]$separator_left#[fg=#c6c8d1,bg=#1e2132] $module_left_3 #[fg=#1e2132,bg=#1e2132,nobold,nounderscore,noitalics]$separator_left"
set -g status-right "#[fg=#1e2132,bg=#1e2132,nobold,nounderscore,noitalics]$separator_right#[fg=#c6c8d1,bg=#1e2132] #[fg=#2e3244,bg=#1e2132,nobold,nounderscore,noitalics]$separator_right#[fg=#c6c8d1,bg=#2e3244] $module_right_1 #[fg=#454b68,bg=#2e3244,nobold,nounderscore,noitalics]$separator_right#[fg=#c6c8d1,bg=#454b68,bold] $module_right_2 #{prefix_highlight}"
setw -g window-status-format "#[fg=#1e2132,bg=#1e2132,nobold,nounderscore,noitalics]$separator_right#[fg=#c6c8d1] #I $subseparator_right #W $subseparator_left#[fg=#1e2132,bg=#1e2132,nobold,nounderscore,noitalics]$separator_right"
setw -g window-status-current-format "#[fg=#2e3244,bg=#1e2132,nobold,nounderscore,noitalics]$separator_right#[fg=#c6c8d1,bg=#2e3244] #I $subseparator_right #W $subseparator_left #F #[fg=#2e3244,bg=#1e2132,nobold,nounderscore,noitalics]$separator_left"

# utilities
bind-key M command-prompt -p "Manpage:" "neww 'MANWIDTH=80 man %%'"
bind-key m command-prompt -p "Manpage:" "split-window -h 'MANWIDTH=80 man %%'"

# Reload Config File
bind r source-file ~/.tmux.conf \; display-message "Reloading config file..."
